# Ecological network assembly: how the regional metaweb influences local food webs 

Leonardo A. Saravia ^1^ ^2^ ^6^, Tomás I. Marina ^3^, Nadiah P. Kristensen ^5^, Marleen De Troch ^4^,  Fernando R. Momo ^1^ ^2^

1. Instituto de Ciencias, Universidad Nacional de General Sarmiento, J.M. Gutierrez 1159 (1613), Los Polvorines, Buenos Aires, Argentina.

2. INEDES, Universidad Nacional de Luján, CC 221, 6700 Luján, Argentina.

3. Centro Austral de Investigaciones Científicas (CADIC-CONICET), Ushuaia, Argentina.

4. Marine Biology, Ghent University, Krijgslaan 281/S8, B-9000, Ghent, Belgium.

5. Department of Biological Sciences, National University of Singapore, 14 Science Drive 4 Singapore 117543, Singapore.

6. Corresponding author e-mail lsaravia@campus.ungs.edu.ar, ORCID https://orcid.org/0000-0002-7911-4398


**keywords**: Metaweb, ecological network assembly, network assembly model, food web structure, modularity , trophic coherence, motif, topological roles, null models

**Running title**: The metaweb influence on local food webs.

\newpage


## Abstract 

<!-- NPK: I have rewritten the Abstract and added on dot point so it now matches the Author Guidelines -->

<!-- 1. the background -->
1. Local food webs result from a sequence of colonisations and extinctions by species from the regional pool or metaweb, i.e., the assembly process. Assembly is theorised to be a selective process: whether or not certain species or network structures can persist is partly determined by local processes including habitat filtering and dynamical constraints. Consequently, local food web structure should reflect these processes.

<!-- 2. the goal of the study -->
2. The goal of this study was to test evidence for these selective processes by comparing the structural properties of real food webs to the expected distribution given the metaweb. We were particularly interested in ecological dynamics; if the network properties commonly associated with dynamical stability are indeed the result of stability constraints, then they should deviate from expectation in the direction predicted by theory.

<!-- NPK: there was no "goal of the study" in the original version -->

<!-- 3. what was done in the study -->
3. To create a null expectation, we used the novel approach of randomly assembling model webs by drawing species and interactions from the empirical metaweb. The assembly model permitted colonisation and extinction, and required a consumer species to have at least one prey, but had no habitat type nor population dynamical constraints. Three data sets were used: (1) the marine Antarctic metaweb, with 2 local food-webs; (2) the 50 lakes of the Adirondacks; and (3) the arthropod community from Florida Keys' classic defaunation experiment. 

<!-- 4. what was found -->
4. Contrary to our expectations, we found that there were almost no differences between empirical webs and those resulting from the null assembly model. Few empirical food webs showed significant differences with network properties, motif representations and topological roles. Network properties associated with stability did not deviate from expectation in the direction predicted by theory.

<!-- 5. what this means in a broad context -->
5. Our results suggest that --- for the commonly used metrics we considered --- local food web structure is not strongly influenced by dynamical nor habitat restrictions. Instead, the structure is inherited from the metaweb. This suggests that the network properties typically attributed as causes or consequences of ecological stability are instead a by-product of the assembly process (i.e., spandrels), and may potentially be too coarse to detect the true signal of dynamical constraint. 


## Introduction

What determines the structure of a food web? The characterization of ecological systems as networks of interacting elements has a long history [@May1972;@Cohen1985;@Paine1966]; however, the effects of ecological dynamical processes on network structure are not fully understood. Structure is the result of community assembly, which is a repeated process of species arrival, colonization, and local extinction [@Cornell2014]. That implies there are two major components that determine food web structure: the composition of the regional pool, from which the species are drawn; and a selective process, which determines which species can arrive and persist in the local web. The selective process is very complex and involves multiple mechanisms [@Mittelbach2015]. However, we should in theory be able to detect the signal of this process by comparing local webs to the regional pool from which they were drawn. 

The structure of a food web is ultimately constrained by the species and potential interactions that exist in the regional pool, i.e., the metaweb. The regional pool is shaped by evolutionary and biogeographical processes that imply large spatial and temporal scales [@Carstensen2013;@Kortsch2018], and it generally extends over many square kilometers and contains a large number of habitats and communities [@Mittelbach2015].  Each of the local communities that make up the metaweb can have different food web structures, both in terms of the species present and interactions between them. Consequently, the metaweb includes many species co-occurrence and interaction possibilities that do not occur in reality.

Within the ultimate constraint imposed by the metaweb, the composition of the local community is determined by metacommunity processes. Which regional species can arrive and persist in a web is influenced by dispersal, environmental filters, biotic interactions and stochastic events [@HilleRisLambers2012]. These processes have been studied using metacommunity theory, where different spatial assemblages are connected through species dispersal [@Leibold2017].  Recently, there has been an increase in food web assembly studies, integrating them with island biogeography [@Gravel2011], metacommunity dynamics [@Pillai2011; @Liao2016] and the effects of habitat fragmentation [@Mougi2016]. As an extension of the species-area relationship (SAR) approach, one can derive a network-area relationship (NAR) using theoretical models [@Galiana2018]. However, this approach assumes that ecological dynamics (e.g., stability) will have no influence. Compared to the body of metacommunity theory, there are very few studies that have analyzed the assembly process using experimental or empirical data, and none of them focuses on topological network properties that could be related to different assembly processes. @Piechnik2008 found that the first to colonize are trophic generalists followed by specialists, supporting the hypothesis that biotic interactions are important in the assembly process [@Holt1999]. @Baiser2013 showed that habitat characteristics and dispersal capabilities were the main drivers of the assembly. @Fahimipour2014 also found that colonization rates were an important factor.

On top of metacommunity processes, local dynamical processes play a role in determining food web structure, and the potential for stability to constrain food-web structure has received plenty of theoretical attention [@May1972; @McCann2000a]. Some theorists conceive of assembly as a non-Darwinian selection process [@Borrelli2015a], whereby species and structures that destabilize the web will be lost and stabilizing structures persist [@Pawar2009; @Borrelli2015a ]. Typically, assembly simulations produce large webs that are both stable in the dynamical sense and relatively resistant to further invasions [@Luh1993; @Law1996; @Drake1990]. Therefore, we expect that particular structural properties that confer stability will be over-represented in real food webs [@Borrelli2015], as these are the webs that are able to persist in time [@Grimm1992]. 

There is some evidence that real food webs possess stabilizing structural properties. A classic finding is that dynamical models parameterized with realistic species interaction-strength patterns have higher stability than randomized alternatives [@deRuiter1995; @Neutel2002]. The frequency of 3-node sub-networks, called motifs [@Milo2002], is correlated with the stability in ecological [@Borrelli2015a] and other biological [@Prill2005] networks.  However, stability-enhancing structural features can also arise for non-dynamical reasons. For example, the nested structure of mutualistic networks can arise as a spandrel of adaptive radiation [@Maynard2018;@Valverde2018], and low connectance may occur as a consequence of restricted diet breadth and adaptive foraging behavior [@Beckerman2006]. Furthermore, it is niche models --- which are typically interpreted in terms of physiological constraints on predation relationships and do not rely upon population dynamic mechanisms--- that have been most successful at reproducing realistic food web structure [@Williams2000; @Loeuille2005]. This raises the possibility that the structural attributes typically measured in real webs can be explained by other processes, or may be too coarse to detect a subordinate influence of dynamics. 

To test the hypothesis that dynamical selective processes are responsible for food web structure, we need an appropriate null model [@Lau2017]. Here, we propose that the metaweb itself can be used to create that baseline for comparison. We conceive of the metaweb as the source of food-web structural diversity, from which local food web structure is drawn, and upon which local processes can act. Although the metaweb is also a consequence of local assembly processes (being the sum of local webs), it contains species co-occurrences and network structures that never occur in a local web, including those presumably precluded by local dynamics. Therefore, if there are local selective processes that determine the structure of local food webs, then comparing local webs to the metaweb may allow us to separate the larger evolutionary and biogeographical processes from the theorized local selective process. For example, we would expect to find that the structural properties that confer stability are over-represented in local food webs compared to the metaweb.

In this study, we used three empirical metawebs as the basis for the null model, to test for signals of the selective process in 58 local food webs. To create null food webs, we made the most minimal assumption about the metacommunity process possible: any species can colonize from the metaweb and persist in a local web provided that it has at least one prey (food) item available. This null model, therefore, lacks any of the restrictions related to dynamical stability and local habitats that are thought to drive the selection processes of interest. We compared the observed structural network properties of real food webs to those of the null models, including global properties like modularity and mean trophic level, sub-network properties like motifs, and topological roles that estimate the role of species regarding the network modular structure. If real food web structure differs from null models and in the direction predicted by theory, then that is evidence in favour of the hypothesis that food web structure is constrained by dynamics.

<!-- Old version if you need to revert
There is some evidence that real food webs possess stabilizing structural properties. A classic finding is that dynamical models parameterized with realistic species interaction-strength patterns have higher stability than randomized alternatives [@deRuiter1995; @Neutel2002]. The frequency of 3-node sub-networks, called motifs [@Milo2002], is correlated with the stability in ecological [@Borrelli2015a] and other biological [@Prill2005] networks. However, stability-enhancing structural features can also arise for non-dynamical reasons. For example, the nested structure of mutualistic networks can arise as a spandrel of adaptive radiation [@Maynard2018;@Valverde2018], and low connectance may occur as a consequence of restricted diet breadth and adaptive foraging behavior [@Beckerman2006].

However, to test the hypothesis that dynamical selective processes are responsible for food web structure, we need an appropriate null model [@Lau2017] for comparison. When it comes to the broad structural properties that are most commonly measured in real food webs, it is niche models --- which are typically interpreted in terms of physiological constraints on predation relationships and do not rely upon population dynamic mechanisms---
that have been most successful at reproducing realistic food web structure [@Williams2000; @Loeuille2005]. This raises the possibility that the structural attributes typically measured in real webs can be explained by other processes, or may be too coarse to detect a subordinate influence of dynamics. Here, we propose that the metaweb itself can be used to create a baseline for comparison.

In this study, we used three empirical metaweb as the basis for the null model, to test for signals of the selective process in 58 local food webs. To create null food webs, we make the most minimal assumption possible, which is that any species can colonize from the metaweb and persist in a local web provided that it has at least one prey (food) item available. This null model, therefore, lacks any of the restrictions related to dynamical stability and local habitats that are thought to drive the selection processes of interest. We compare the observed structural network properties of real food webs to those of the null models, including global properties like modularity and mean trophic level, sub-network properties like motifs, and topological roles that estimate the role of species regarding the network modular structure. If real food web structure differs from null models and in the direction predicted by theory, then that is evidence in favour of the hypothesis that food web structure is constrained by dynamics.

The structure of a food web is ultimately constrained by the species and potential interactions that exist in the regional pool, i.e., the metaweb. The regional pool is shaped by evolutionary and biogeographical processes that imply large spatial and temporal scales [@Carstensen2013;@Kortsch2018], and it generally extends over many square kilometers and contains a large number of habitats and communities [@Mittelbach2015]. The different local communities have different food web structures, both in terms of the species present and interactions between them. Consequently, the metaweb includes many species co-occurrence and interaction possibilities that do not occur in reality, and provides the diversity from which local food web structure is drawn. If there are local selective processes that determine the structure of local food webs, then comparing local webs to the metaweb may allow us to separate the larger evolutionary and biogeographical processes [@Carstensen2013; @Kortsch2018] from the theorized local selective process.

Within the ultimate constraint imposed by the regional pool, the composition of the local community is determined by metacommunity processes. Which regional species can arrive and persist in a web is influenced by dispersal, environmental filters, biotic interactions and stochastic events [@HilleRisLambers2012]. These processes have been studied using metacommunity theory, where different spatial assemblages are connected through species dispersal [@Leibold2017].  Recently, there has been an increase in food web assembly studies, integrating them with island biogeography [@Gravel2011], metacommunity dynamics [@Pillai2011; @Liao2016] and the effects of habitat fragmentation [@Mougi2016]. As an extension of the species-area relationship (SAR) approach, one can derive a network-area relationship (NAR) using theoretical models [@Galiana2018]. However, this approach assumes that ecological dynamics (e.g., stability) will have no influence. Compared to the body of metacommunity theory, there are very few studies that have analyzed the assembly process using experimental or empirical data, and none of them focuses on topological network properties that could be related to different assembly processes. @Piechnik2008 found that the first to colonize are trophic generalists followed by specialists, supporting the hypothesis that biotic interactions are important in the assembly process [@Holt1999]. @Baiser2013 showed that habitat characteristics and dispersal capabilities were the main drivers of the assembly. @Fahimipour2014 also found that colonization rates were an important factor.

On top of metacommunity processes, the role of dynamical processes in determining food web structure has received a lot of theoretical attention, particularly dynamical stability as a potential constraint [@May1972; @McCann2000a]. Some theorists conceive of assembly as a non-Darwinian selection process [@Borrelli2015a], whereby species and structures that destabilize the web will be lost and stabilizing structures persist [@Pawar2009; @Borrelli2015a ]. Typically, assembly simulations produce large webs that are both stable in the dynamical sense and relatively resistant to further invasions [@Luh1993; @Law1996; @Drake1990]. Therefore, we expect that particular structural properties that confer stability will be over-represented in real food webs [@Borrelli2015], as these are the webs that are able to persist in time [@Grimm1992]. Here, the metaweb is conceived of as both the consequence of local assembly processes and the source of food-web structural diversity upon which local selective forces can act. Differences between local webs in the metaweb occur e.g., due to the stochastic order of arrival of species, which sends the local assembly tractories towards different stable states. Consequently, the metaweb as a whole describes species co-occurrences and interactions that are precluded by local dynamics, and therefore, the structural properties that confer stability should be over-represented in local food webs compared to the metaweb.

There is some evidence that real food webs possess stabilizing structural properties. A classic finding is that dynamical models parameterized with realistic species interaction-strength patterns have higher stability than randomized alternatives [@deRuiter1995; @Neutel2002]. The frequency of 3-node sub-networks, called motif [@Milo2002], is correlated with the stability in ecological [@Borrelli2015a] and other biological [@Prill2005] networks. Other stability-enhancing structural features can also arise for non-dynamical reasons; for example, the nested structure of mutualistic networks can arise as a spandrel of adaptive radiation [@Maynard2018;@Valverde2018], and low connectance may occur as a consequence of restricted diet breadth and adaptive foraging behavior [@Beckerman2006].

However, to test the hypothesis that dynamical selective processes are responsible for food web structure, we need an appropriate null model [@Lau2017] for comparison. When it comes to the broad structural properties that are most commonly measured in real food webs, it is niche models ---which are typically interpreted in terms of physiological constraints on predation relationships and do not rely upon population dynamic mechanisms---
that have been most successful at reproducing realistic food web structure [@Williams2000; @Loeuille2005]. This raises the possibility that the structural attributes typically measured in real webs can be explained by other processes, or may be too coarse to detect a subordinate influence of dynamics. Here, we propose that the metaweb itself can be used to create a baseline for comparison.
-->

## Methods

We compiled three metawebs with their corresponding local food webs, with a total of 58 local food webs from a variety of regions and ecosystems. We built the first metaweb from the Southern Ocean database compiled by @Raymond2011, selecting only species located at latitudes higher than 60°S. @Raymond2011 compiled information from direct sampling methods of dietary assessment, including gut, scat, and bolus content analysis, stomach flushing, and observed feeding. We considered that the metaweb is the regional pool of species defined by the biogeographic Antarctic region. As local food webs we included two of the most well-resolved datasets publicly available for the region: Weddell Sea and Potter Cove food webs. The first includes species situated between 74°S and 78°S with a West-East extension of approximately 450 km and comprises all information about trophic interactions available for the zone since 1983 [@Jacob2011], this dataset was obtained from @Brose2005. The Potter Cove food web comes from a 4 km long and 2.5 km wide Antarctic fjord located at 62°14'S, 58°40'W, South Shetland Islands [@Marina2018]. To make datasets compatible, we firstly checked taxonomic names for synonyms, and secondly added species (either prey or predator) with their interactions to the metaweb when the local food webs contain a greater taxonomic resolution. This resulted in the addition of 258 species to the metaweb, which represent 33% of the total. We named this the Antarctic metaweb, which has 846 species ($S$), 6897 links ($L$) and a connectance ($L/S^2$) of 0.01. 

The second metaweb was collected from pelagic organisms of 50 lakes of the Adirondacks region [@Havens1992], which were sampled once during summer 1984 [@Sutherland1989]. @Havens1992 determined the potential predator–prey interactions among 211 species from previous diet studies; species that lacked a trophic link were deleted and feeding links were assumed when the species involved were present in a particular lake. The so-called Lakes metaweb considers 211 species, 8426 links and a connectance of 0.19, this was obtained from the GATEWAy database [@Brose2019].   

The third metaweb comes from a well-known defaunation experiment performed in the Florida Keys in the 1960’s [@Simberloff1969; @Piechnik2008], where six islands of 11–25 meters in diameter were defaunated with insecticide. The arthropods were censused before the experiment and after it approximately once every 3 weeks during the first year and again 2 years after defaunation. For the metaweb and local webs we used only the first census that represent a complete community. @Piechnik2008 determined the trophic interactions among 155 species (5114 links,connectance 0.21) using published information and expert opinions. This dataset was obtained directly from the authors of @Gravel2011.


### Metaweb Assembly Null Model


To consider network assembly mechanisms we used a metaweb assembly model (Figure 1), similar to the trophic theory of island biogeography [@Gravel2011]. In this model species migrate from the metaweb to a local web with a probability $c$, and become extinct from the local web with probability $e$; a reminiscence of the theory of island biogeography [@MacArthur1967], but with the addition of network structure. Species migrate with their potential network links from the metaweb, then in the local web, species have a probability of secondary extinction $se$ if none of its preys are present, which only applies to non-basal species. When a species goes extinct locally it may produce secondary extinctions modulated by $se$ (Figure 1). 

Then there are three possible events: colonization, extinction, and secondary extinction. After a colonization event with probability $c$, the species is present in the local community and two other events are possible: 

  1. if it is a basal species it does not need predators to survive, then it persists until an extinction event with probability $e$;
  2. if it is a non-basal species it could become extinct with probability $e$ but if it has no prey it could also become extinct with probability $se$.

These events could happen at random if the necessary conditions are fulfilled, to simulate the model we use the @Gillespie1976a algorithm that produces an statistically exact trajectory of the stochastic process [@Black2012].

We simulated this model in time and it eventually reached a steady state that depends on the migration and extinction probabilities but also on the structure of the metaweb. The ratio of immigration vs. extinction $\alpha= c/e$ is hypothesized to be inversely related to the distance to the mainland [@MacArthur1967], and as extinction should be inversely proportional to population size [@Hanski1999], the ratio $\alpha$ is also hypothesized to be related to the local area.

For the model used in @Gravel2011, simulations with the same ratio $\alpha= c/e$ should give the same results, but as our model incorporates $se$ as an additional parameter this might not be the case. We checked this performing simulations with different combinations of $c$, $e$, and $se$ keeping $\alpha$ constant for different metawebs. We found differences for some of the combinations (Figure S6), thus we performed the fitting using the 3 parameters. 

To fit the model to each metaweb we performed 150000 simulations with a wide range of parameters (Table S1) using latin hypercube sampling [@Fang2005]. We simulated the model for 1000 time steps and use the last 100 time steps to calculate averages for the number of species $S_m$, the number of links $E_m$ and the connectance $C_m = E_m/S_m^2$. Then we calculated a relative distance to the number of species $S_e$ and connectance $C_e$ of the empirical food webs:  

$$distance = \sqrt{ ((S_e - S_m) / S_e )^2 + ((C_e - C_m)/ C_e)^2 }$$

Then we used the parameters with the minimal distance to simulate the model and compare with the network properties described in the following section. The fitted parameters for all local food webs are presented in table S2.

In summary, this model considers colonization-extinction and secondary extinctions events constrained by network structure, with no consideration of population dynamics and interaction strength. Then, this simple model acts as a null model: if we observe a deviation from a network property obtained with the null model then those mechanisms that are excluded from the model may be acting [@DeBello2012]. 

![Schematic diagram of the metaweb assembly null model: species migrate from the metaweb with a probability $c$ to a local network carrying their potential links; here they have a probability of extinction $e$. Additionally, predators become extinct if their preys are locally extinct with probability $se$. We simulate 1000 local networks and calculate network properties. From the distribution of these topological properties we calculate 1% confidence intervals to compare with empirical networks](Figures/MetaWebAssemblyModelFigure.pdf)


### Structural network properties

We selected properties related to stability and resilience like: trophic coherence that is based on the distances between the trophic positions of species and measures how well species fall into discrete trophic levels [@Johnson2014;@Johnson2017]; mean trophic level, historically used as an ecosystem health indicator [@Pauly1998], predicting that food webs with higher trophic levels are less stable [@Borrelli2014]; modularity, that measures the existence of groups of prey and predators that interact more strongly with each other than with species belonging to other modules and it prevents the propagation of perturbations throughout the network, increasing its persistence [@Stouffer2011]; and a measure of local stability using the eingenvalues of randomly parameterised networks. 

To describe food webs as networks each species is represented as a node or vertex and the trophic interactions are represented as edges or links between nodes. These links are directed, from the prey to the predator, as the flow of energy and matter. Two nodes are neighbours if they are connected by an edge and the degree $k_i$ of node $i$ is the number of neighbours it has. The food web can be represented by an adjacency matrix $A=(a_{ij})$ where $a_{ij}=1$ if species $j$ predates on species $i$, else is 0. Then $k_i^{in}=\sum_j{a_{ji}}$ is the number of preys of species $i$ or its in-degree, and $k_i^{out}=\sum_j{a_{ij}}$ is the number of predators of $i$ or its out-degree. The total number of edges is $L=\sum_{ij}a_{ij}$. 

We first calculated a property called trophic coherence [@Johnson2014], that is related to stability in the sense that small perturbations could get amplified or vanished, which is called local linear stability [@May1972;@Rohr2014]. We first needed to estimate the trophic level of a node $i$, defined as the average trophic level of its preys plus 1. That is:

\begin{align}
tp_i= 1 + \frac{1}{k_i^{in}}\sum_{j}{a_{ij} tp_j}
\end{align}

where $k_i^{in}=\sum_{j}a_{ji}$ is the number of preys of species $i$, basal species that do not have preys (then $k_i^{in}=0$) are assigned a $tp=1$. Then the trophic difference associated to each edge is defined as $x_{ij}=tp_i - tp_j$. The distribution of trophic differences, $p(x)$, has a mean $L^{-1} \sum_{ij} a_{ij} x_{ij} = 1$ by definition. Then the trophic coherence is measured by:

\begin{align}
Q = \sqrt{\frac{1}{L} \sum_{ij}a_{ij}x_{ij}^2 - 1}
\end{align}


that is the standard deviation of the distribution of all trophic distances. A food web is more coherent when $Q$ is closer to zero, thus the maximal coherence is achieved when $Q = 0$, and corresponds to a layered network in which every node has an integer trophic level [@Johnson2014; @Johnson2017]. To compare coherence and trophic level we generated 1000 null model networks with the fitted parameters of the metaweb assembly model. Then we calculated the 99% confidence interval using the 0.5% and 99.5% quantiles of the distribution of $Q$. We also calculated the CI for the mean trophic level.

Another property related to stability is modularity, since the impacts of a perturbation are retained within modules minimizing impacts on the food web [@Fortuna2010; @Grilli2016]. It measures how strongly sub-groups of species interact between them compared with the strength of interaction with other sub-groups [@Newman2004]. These sub-groups are called modules. To find the best partition, we used a stochastic algorithm based on simulated annealing [@Reichardt2006]. Simulated annealing allows maximizing modularity without getting trapped in local maxima configurations [@Guimera2005]. The index of modularity was defined as: 

\begin{align}
M = \sum_s \left(\frac{I_s}{L} - \left(\frac{d_s}{2L}\right)^2 \right)
\end{align}

where $s$ is the number of modules, $I_s$ is the number of links between species in the module $s$, $d_s$ is the sum of degrees for all species in module $s$ and $L$ is the total number of links for the network. As the simulated annealing algorithm is stochastic we estimated modularity as the mean of 100 repetitions.  To assess the significance of our networks we calculated the 99% confidence intervals based on 1000 null model networks as previously described. 


Finally, we calculated the average of the maximal real part of the eigenvalues of the jacobian [@Grilli2016] for randomly parametrized systems, keeping fixed the predator-prey (sign) structure. This is a measure related to quasi sign-stability (QSS) that is the proportion of randomly parametrized systems that are locally stable [@Allesina2008a]. The Jacobian $J$, so-called community matrix [@May1973], represents the population-level effect of a change in one species’ density on any other species, including the dependence on its own density (self-regulation), at an equilibrium. A system is locally stable if the Jacobian $J$ has all its eigenvalues negative, thus the maximal eigenvalue has to be less than zero for a system to be locally stable. The signs of the elements of $J$ are given by the predator-prey structure of the food web, but the magnitude of the elements are unknown. Following previous analysis [@Monteiro2016;@Borrelli2015a], we estimated the unknown magnitudes by drawing the predator-prey interactions from a uniform distribution ranging from -10 to 0, the prey-predator interactions from 0 to 0.1, and from 0 to -1 for the self-regulation effect. This implies that the predator effect on the prey is bigger than the effect of the prey on the predator, and that the self-regulation or self-damping effect, that scales the dynamic's return time, is generally smaller than the predator-prey effect. Besides other parametrizations are possible they give very similar results (not shown). We sampled 1000 jacobians to estimate the maximal real part of the eigenvalues and withhold the average, we repeat this procedure for each of the 1000 null model networks and estimated the 99% confidence intervals as described earlier.


To show the results graphically we calculated the deviation for each metric, which correspond to the 99% confidence intervals for the metric’s value in the assembly null model. We define the mid-point

$$metric_{mid} = metric_{low} + \frac{metric_{high} - metric_{low}}{2}$$

Then the deviation of the observed value of the real web is calculated

$$deviation = \frac{metric_{observed} - metric_{mid}}{metric_{high} - metric_{low}}$$

A deviation value outside of [-0.5, 0.5] indicates that the value is outside of the 99% confidence interval. 

### Motifs

We considered the abundance of sub-networks that deviates significantly from a null model network, which are called motifs [@Milo2002]. In practice, sub-networks are generally called motif without taking into account the mentioned condition. We analyzed here the four three-species motifs that have been most studied theoretically and empirically in food webs [@Prill2005;@Stouffer2007;@Baiser2016] (Figure 2). During the assembly process, motifs that are less dynamically stable tend to disappear from the food web [@Borrelli2015a; @Borrelli2015]. Furthermore, different motifs patterns could also be the result of habitat filtering [@Baldassano2016; @Dekel2005] 

The four three-species motifs are: apparent competition, where two preys share a predator; exploitative competition, where two predators consume the same prey; omnivory, where predators feed at different trophic levels; and tri-trophic chain, where the top predator consumes an intermediate predator that consumes a basal prey (Figure 2). These are the most common motifs present in food webs [@Monteiro2017; @Borrelli2015a]. We compared the frequency of these motifs to 1000 null model networks using the 99% confidence intervals, and deviation as previously described.

![The four three-species motifs analysed: apparent competition, exploitative competition, tri-trophic chain, and omnivory.  Motifs are three-node sub-networks. These four Motifs have been explored both theoretically and empirically in ecological networks and are the most common found in food webs](Figures/Fig1Motifs.png)

### Topological roles

To detect the process of habitat filtering or dispersal limitation in local food webs we calculated topological roles, which characterize how many trophic links are conducted within their module and/or between modules [@Guimera2005; @Kortsch2015]. Theoretical and empirical results suggest these roles are related to species traits, such as niche breadth, environmental tolerance, apex position in local communities and motility [@Borthagaray2014;@Guimera2010;@Rezende2009;@Kortsch2015;@Dupont2009]. 

We determined topological roles using the method of functional cartography [@Guimera2005], which is based on module membership (See modularity). The roles are characterized by two parameters: the standardized within-module degree $dz$ and the among-module connectivity participation coefficient $PC$.  The within-module degree is a z-score that measures how well a species is connected to other species within its module:

$$dz_i = \frac{k_{is}-\bar{k_s} }{\sigma_{ks}}$$ 


where $k_{is}$ is the number of links of species $i$ within its own module $s$, $\bar{k_s}$ and $\sigma_{ks}$ are the average and standard deviation of $k_{is}$ over all species in $s$. The participation coefficient $PC$ estimates the distribution of the links of species $i$ among modules; thus it can be defined as:

$$PC_i =  1 - \sum_s \frac{k_{is}}{k_i}$$ 

where $k_i$ is the degree of species $i$ (i.e. the number of links), $k_{is}$ is the number of links of species $i$ to species in module $s$. Due to the stochastic nature of the module detection algorithm, we made repeated runs of the algorithm (starting from 100 runs) until there were no statistical differences between the distributions of $PC_i$ and $dz_i$ in successive repetitions; to test such statistical difference we used the k-sample Anderson-Darling test [@Scholz1987]. Then we calculated the mean and 95% confidence interval of $dz$ and $PC$.

To determine each species' role the $dz-PC$ parameter space was divided into four areas, modified from @Guimera2005, using the same scheme as @Kortsch2015. Two thresholds were used to define the species’ roles: $PC=0.625$ and $dz=2.5$. If a species had at least 60% of links within its module then $PC<0.625$, and if it also had $dz\ge 2.5$, thus it was classified as a module hub. This parameter space defines species with a relatively high number of links, the majority within its module. If a species had $PC<0.625$ and $dz<2.5$, then it was called a peripheral or specialist; this refers to a species with relatively few links, mostly within its module. Species that had $PC\ge0.625$ and $dz<2.5$ were considered module connectors, since they have relatively few links, mostly between modules. Finally, if a species had $PC\ge0.625$ and $dz\ge 2.5$, then it was classified as a super-generalist or hub-connector because it has high between- and within-module connectivity. 

We estimated the roles for empirical networks and for 20 realizations of each assembly model network. To test if the proportion of species’ roles changed between the empirical and each of the realizations of the model we performed a Pearson's Chi-squared test with simulated p-value based on 10000 Monte Carlo replicates. 

All analyses and simulations were performed in R version 4.0.3 [@RCoreTeam2017], using the igraph package version 1.2.6 [@Csardi2006] for motifs, the package multiweb for topological roles, $Q$ and other network metrics [@Saravia2019c], and the package meweasmo for the metaweb assembly model [@Saravia2020]. Source code and data are available at zenodo <https://doi.org/10.5281/zenodo.3370022> and GitHub <https://github.com/lsaravia/MetawebsAssembly/>.  

## Results

A general description of all networks using the structural properties including metawebs is presented in appendix table S3. For the Antarctic metaweb, the differences in the number of species (size) between local food webs and the metaweb are greater than for the other metawebs. It is the biggest metaweb in size, but its connectance is lowest. The metawebs of Florida Islands and Adirondacks' Lakes have similar size and both are smaller than the Antarctic metaweb, that have a lower connectance.  Thus there is a wide range of local food web sizes (13 to 435), number of links (17 to 1978), and connectance (0.01 to 0.29) in our dataset. We cannot directly compare the metaweb properties with the local webs properties since they are dependent on size, number of links and/or connectance [@Dunne2002a; @Poisot2014]. The comparison of the local networks with the networks generated by the fitted assembly null model takes into account this issue.

We found almost no differences between the assembly null model and the local food webs for trophic coherence (Q) with the execption of E1 Island (Figure 3, Table S5). The mean maximal eingenvalue (MEing) was also not different except for Weddell Sea, which has a lower value resulting in an increased local stability, and four local webs from the Lakes dataset (Briddge Brook Lake, Chub Pond, Hoel Lake, Long Lake) which have a higher MEing and lower stability than the model (Figure 3, Table S5). Only Weddell Sea and E1 Island were significantly different for mean trophic level (TL) (Figure 4, Table S4), only E1 Island have a lower TL, this should be the expected pattern if dynamical stability constraints where acting. For modularity we found only two local food webs different, Chub Pond, from Lakes metaweb, that is less modular than the model and Island E9 which is more modular (Figura 4, Table S5). 

![Trophic coherence (Q) and mean of maximal eingenvalue (MEIng) comparison for local empirical networks (dots) and assembly null model networks. We ran 1000 simulations of the metaweb assembly model fitted to local networks to build the 99% confidence intervals of the metric and calculated the deviation; a value outside -0.5,0.5 interval (vertical dotted lines) indicates that the value is outside of the 99% confidence interval. Colors represent metawebs to which local food webs belong, where *Ant* is the Antarctic, *Isl* is the Islands, and *Lak* the lakes metaweb.](Figures/MEing_Q_Assembly_byMeta.pdf)


![Modularity and mean trophic level comparison for local empirical networks (dots) and assembly null model networks. We ran 1000 simulations of the metaweb assembly model fitted to local networks to build the 99% confidence intervals of the metric and calculated the deviation; a value outside -0.5,0.5 interval (vertical dotted lines) indicates that the value is outside of the 99% confidence interval. Colors represent metawebs to which local food webs belong, where *Ant* is the Antarctic, *Isl* is the Islands, and *Lak* the lakes metaweb.](Figures/Modularity_TL_Assembly_byMeta.pdf)


Comparing the motifs generated from the metaweb assembly null model, 9 of 58 (16%) networks showed at least one significant motif over-representation and only one (Weddell Sea) showed motifs under-representation (Figure 5, Table S6). The Hoel lake network was the only one that showed over-representation for all motifs. Long lake showed only omnivory over-representation, and 5 more have only 1 motif (not omnivory) over-representation. Apparent competition and exploitative competition were the most over-represented motifs (6 and 5 times).

The proportions of topological roles were similar to the metaweb assembly model; across the 20 realizations of the assembly model, between 3 and 10 out of 58 local (5-17%) were different at 1% significant level (Table S8). Figure 6 shows the proportions for the Antarctic and Islands metawebs for one realization of the model and Figure S5 shows the proportions for the Lakes metaweb; we added the topological role proportions for the corresponding metaweb in each case to visually compare with both the empirical and model food webs. The only food web that showed consistent differences with the model was Potter Cove (100% of the realizations), the second the Island E9 with 60% and the thied the Weddell Sea food web that showed differences 50% of the time (Table S9). 


![Motifs' abundance comparison for local empirical networks (dots) and assembly null model networks. We ran 1000 simulations of the metaweb assembly model fitted to local networks to build the 99% confidence intervals of the metric and calculated the deviation; a value outside -0.5,0.5 interval (vertical dotted lines) indicates that the value is outside of the 99% confidence interval. Colors represent metawebs to which local food webs belong, where *Ant* is the Antarctic, *Isl* is the Islands, and *Lak* the lakes metaweb.](Figures/Motif_Zscores_Assembly.pdf){ width=100% }


![Topological roles proportions for local empirical networks and metawebs compared with assembly null model for the Antarctic (A) and Islands metawebs (B). The topological roles are: *Hub connectors* have a high number of between module links; *Module connectors* have a low number of links mostly between modules;  *Module hubs* have a high number of links inside its module; *Module specialists* have a low number of links inside its module. Plots marked with '*' are different from the null model at 1% level](Figures/Ant_Isl_TopoRoles_ByNetwork_Model.png)

## Discussion

We hypothesised that, if local processes like dynamical stability determine food web structure, then we should observe a consistent difference in network properties between real webs and model webs randomly assembled from the regional metaweb. Contrary to our expectations, we found that most structural properties did not differ significantly between real and randomly assembled webs. We investigated network properties associated with dynamical stability (trophic coherence, modularity, MEing, motifs). Although we found differences for some local food webs, there was not a general pattern, and real web properties did not display a consistent tendency to deviate in the direction predicted by theory. We also investigated topological roles, which we expected to change due to habitat filtering and dispersal limitation. However, with the exception of the two Antarctic webs, we found a similar lack of difference between real and model webs. These results suggest that --- for the metrics we considered --- food webs are mainly shaped by metaweb structure, and we did not find good evidence for the influence of local dynamics. <!-- stability, environmental drivers or assembly processes.-->

Local food webs are expected to have relatively few trophic levels [@Williams2002;@Borrelli2014]. Different hypotheses have been posed to explain this pattern: the low efficiency of energy transfer between trophic levels, predator size, predator behaviour, and consumer diversity [@Young2013]. Recently, it has been proposed that maximum trophic level could be related to productivity and ecosystem size depending on the context but related to energy fluxes that promote omnivory [@Ward2017]. We found that the mean trophic level of the real webs was not different from randomly assembled webs in most cases. 

We expected modularity to differ between real and randomly assembled webs both due to the influence of habitat heterogeneity [@Krause2003;@Rezende2009] and modularity's stability-enhancing effects. Recent studies suggest that modularity increases local stability, and this effect is stronger the more complex the network is [@Stouffer2011]. This suggests that modularity should be higher in real webs than random webs. However, the effect on stability also strongly depends on the interaction strength configuration [@Grilli2016] and the existence of external perturbations [@Gilarranz2017]. We found no significant difference in modularity from the assembly model in most cases except one: Chub Pond from the Lakes metaweb. 


Due to dynamical stability constraints, we expected real webs to have a lower maximum eigenvalue ($MEing$) and higher trophic coherence ($Q$) than randomly assembled webs.  However, only the Weddell Sea followed this expectation (i.e. greater stability, lower $MEing$), and four local food webs belonging to the Lakes metaweb showed the opposite pattern (i.e. lower stability, higher $MEing$). Thus, although this evidence is not conclusive concerning the importance of dynamical stability in the assembly of food webs, the structure of the local food webs examined here seems to be a consequence of the metaweb structure. 

We also expected real webs to have a higher frequency of stability-enhancing motifs than randomly assembled webs.  Specifically, we expected an over-representation of tri-trophic chains, exploitative competition, and apparent competition [@Borrelli2015a].  Some Lakes food webs had an an over-representation of stability-enhancing motifs, but there was not a consistent pattern.  Further, Lakes webs with an over-representation of stability-enhancing motifs often had low local stability (measured as high MEing).  The omnivory motif can either enhance or diminish stability, depending on the context [@Monteiro2016].  In our study, omnivory seemed to be destabilizing: food webs with an over-representation of it (Chub Pond, Hoel Lake and Long Lake) were also those with significant lower local stability (higher MEing); and Weddell Sea, which had the most significant higher local stability result, also had the most significant under-representation of omnivory.  Food webs are more than the sum of their three-species modules [@Cohen2009a], which is exemplified by the contradictory results for the Weddell Sea food web: high mean trophic level, enhancing stability, but an under-representation of omnivory and apparent competition motifs. 

The relative proportions of topological roles were similar between real and randomly assembled webs except in two Antarctic food webs (Weddell Sea and Potter Cover) and some from the Islands metaweb (E2, E5, E9).  These differences could reflect real differences between the habitats of the local webs and the metaweb.  For example, in the metaweb, the Antarctic cod (*Notothenia coriiceps*) is a module hub (a species with most of its links within its module), but in Potter Cove, it is a super-generalist.  In the Antarctic web, similar to observations in other Arctic and Caribbean marine food webs [@Kortsch2015; @Rezende2009], modules typically correspond to a particular habitat, e.g., a benthic module, a pelagic module, etc.  Consequently, given that local webs are smaller than the metaweb and could cover a particular habitat, habitat filtering (a local process that is not included in the random assembly model) could plays a large role.  In contrast, the Lakes local food webs seem to be covered by similar local habitats. 

<!-- NPK: I've now fixed the wording on this -->
The lack of difference between real and randomly assembled webs raises the possibility that, for these commonly used metrics that we measured, the values they take in local food webs merely reflect the properties of the metaweb. That does not mean that they are indeed the result of random assembly, nor that local processes like dynamical constraints do not act in reality. Rather, it suggests that, without further evidence, one cannot take for granted that these metrics reflect dynamical constraints (see @Zhang2020a for a similar argument regarding species co-occurrence patterns). This is particularly true given that the metrics associated with dynamical constraints can also be subordinate to other more fundamental structure-determining forces.  For example, high trophic coherence means that the trophic levels are fairly distinct and there is little to no omnivory.  Trophic coherence is associated with high stability;  however, it has also been been modelled as a consequence of the relative strength of competition versus width of consumption niche, all mediated by a physiological trait such as body size [@Loeuille2005].  Further, adaptive foraging [@Heckmann2012] also leads to the emergence of trophic coherence in theoretical assembly models [@Drossel2001], which has the side-effect of lowering connectance and hence increasing stability [@Beckerman2006]. 

Assuming that population dynamics does indeed play some role in determining food web structure, why then did we not observe its signal?  One possible reason is that the effect of dynamics on the local network properties also manifests on regional scales.  The metaweb structure is an aggregation of local webs [@Araujo2014;@Ricklefs1987]; therefore, if dynamical constraints prevent certain network structures from occurring in local webs, then they are also prevented in the metaweb. However, while it is obviously true that local processes influence metaweb structure, we still expected to see differences between real webs and those randomly assembled from the metaweb.  Local food webs differ from one another due to e.g., historical contingencies, like the stochastically determined order of arrival of species.  These differences between local webs provide the species and structural diversity in the metaweb upon which non-Darwinian selection process is theorised to act [@Borrelli2015a].  It is important to note that a species that is stabilising in one food web can be destabilising in another.  In contrast, the metaweb describes species co-occurrences and interaction possibilities that do not occur in reality, including those that are presumably precluded due to dynamical constraints.  Therefore, if the non-Darwinian selection process is true, we should expect to see differences between real and randomly assembled webs, not only due to these historical contingencies, but also due to subsequent dynamical constraints that precluded certain co-occurrences and interactions from occurring.

Another possible reason why we did not observe the expected difference between real and randomly assembled webs is that these commonly used metrics are too coarse to detect the signal of dynamical constraint. We chose popular structural metrics that have been associated with stability in the literature; however, stability also depends on interaction strengths.  For example, generalisations about the relationship between modularity and stability cannot be made without first characterising the distribution of interaction strengths [@Grilli2016], which were unknown for our webs.  Further, given that most predator-prey interactions are weak [@McCann1998;@Neutel2002], the structure of the species-rich food webs we investigated might mask the importance of the few strong links.  Theoretical predictions relating stability to structure also depend on the particulars of the community and the type of perturbation considered [@Cenci2018].  It is known that small changes in network structure can have large effects on food web stability [@Fox2006].  It is also known that the sum of effects of positive and negative feedback loops that determine stability can interact in counterintuitive ways [@Hosack2009]. Therefore, it may not be possible to reduce those complex interactions into simple structural metrics.

In conclusion, we found that the commonly used metrics of network structure do not differ between real food webs and model webs randomly assembled from the regional metaweb.  This suggests that evolutionary and metacommunity assembly processes are more important to these aspects of food web structure than local dynamics. However, this kind of analysis needs to be expanded to other regions and habitat types to confirm whether or not this is a general pattern.

## Acknowledgements

We are grateful to the National University of General Sarmiento for financial support (Project 30/1139). LAS would like to thank Susanne Kortsch that shared with us her source code for topological analysis and figures. This work was partially supported by a grant from CONICET (PIO 144-20140100035-CO). 

## Authors’ contributions

LAS, TIM, MDT and FRM conceived the ideas and designed methodology; TIM and LAS collected the data; LAS wrote the code; LAS, TIM and NPK analysed the data; NPK, LAS and TIM led the writing of the manuscript. All authors contributed critically to the drafts and gave final approval for publication.

## Data Availability Statement

The source code and data is available at zenodo <https://doi.org/10.5281/zenodo.3370022> and Github <https://github.com/lsaravia/MetawebsAssembly/>.  


## References

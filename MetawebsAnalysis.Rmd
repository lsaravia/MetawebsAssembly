---
title: "From metawebs to regional and local"
author: "L.A.S."
output: html_document
editor_options: 
  chunk_output_type: console
---

## Setup

- **I run the analysis chunk by chunk, not the whole Rmd** 

- So I set `eval=TRUE` or `eval=FALSE` to run a particular chunk or I run it interactively 

```{r setup, eval=TRUE,echo=FALSE }

if(file.exists(".RData")) load(".RData")

source("R/network_fun.r")

require(igraph)
require(dplyr)
require(stringr)
if( require(meweasmo) == FALSE)
  install_github("lsaravia/meweasmo")
if( require(multiweb) == FALSE)
  install_github("lsaravia/multiweb")

#
# Read data and trim species names to avoid duplicates 
#
#dtot <- read.delim("Data/Foodwebs.dat", quote="",stringsAsFactors = F)
dtot <- read.delim("Data/FoodwebsFixed.dat", quote="",stringsAsFactors = F)
dtot <- dtot %>% mutate(Predator_name=str_trim(Predator_name), Prey_name=str_trim(Prey_name))

```


# Modularity Analysis - Potter 

```{r ModularityAnalysisLocal, eval=FALSE,echo=F,message=T,warning=T}
#
# Select local food web - Potter Cove
#
dtot1 <- as.matrix(dtot %>% filter(Network=="Local") %>% dplyr::select(Prey_name,Predator_name))
redl <- graph_from_edgelist(dtot1, directed  = T)

#
# Make short names 
#
require(vegan)
spnames <- make.cepnames(V(redl)$name)
#write.csv(V(redl)$name,"Local.csv")

# Test if there are duplicated species
#
V(redl)$name[grep(".1",spnames)]

# Check for detritos
# 
grep("detr", V(redl)$name, ignore.case = TRUE, value=TRUE  )
grep("necr", V(redl)$name, ignore.case = TRUE, value=TRUE  )


res <- compare_with_ER(redl, "local",1000)

simulations_ER <- res$sim
websTbl <- res$su
#
# Run modularity 
#
set.seed(123)
modulos<-cluster_spinglass(redl)

#
# Add the modulos object to a vector  
#
mod_by_red <- vector(mode="list", length=3)
mod_by_red[[1]] <- modulos



# Plot the Network
# 

#
# Calculate Trophic Position
#
require(NetIndices)
trophl<-TrophInd(get.adjacency(redl,sparse=F),Dead=c("Fresh detritus","Aged detritus","Necromass"))

# Add colors to nodes 
#
require(RColorBrewer)

colTL <-as.numeric(cut(trophl$TL,11))
colnet <- brewer.pal(11,"RdYlGn")
V(redl)$color <- colnet[12-colTL]

#
# Calculate Trophic Position
#
require(NetIndices)
trophl<-TrophInd(get.adjacency(redl,sparse=F),Dead=c("Fresh detritus","Aged detritus","Necromass"))

#
# Generate a matrix layout
#
layout.matrix.1<-matrix(
  nrow=length(V(redl)),  # Rows equal to the number of vertices
  ncol=2
)


#
# Plot modules
#
layout.matrix.1[,2]<-jitter(trophl$TL,0.4) # y-axis value based on trophic level
layout.matrix.1[,1]<-jitter(modulos$membership,1) # randomly assign along x-axis

#png("Figures/LocalFoodWeb.png",width=6,height=6,units="in",res=600)
par(fig = c(0, 1, 0, 1), oma = c(0, 0, 0, 0), mar = c(0, 0, 0, 0))

plot(redl, vertex.color=vertex_attr(redl)$cor,vertex.label=NA,
     vertex.size=log(3*igraph::degree(redl)),
     edge.width=.3,edge.arrow.size=.4, 
     edge.color="grey50",
     edge.curved=0.3, layout=layout.matrix.1)

dev.off()

pott <- redl
rm(res,redl)

save.image()
```

# Modularity Analysis - Weddell

```{r ModularityAnalysisRegional, eval=FALSE,echo=F,message=T,warning=T}

#
# Select food web 
#
dtot1 <- as.matrix(dtot %>% filter(Network=="Regional") %>% dplyr::select(Prey_name,Predator_name))
redl <- graph_from_edgelist(dtot1, directed  = T)
redl <- simplify(redl)

#
# Make short names 
#
require(vegan)
spnames <- make.cepnames(V(redl)$name)
#write.csv(V(redl)$name,"Regional.csv")

# Test if there are duplicated species
#
V(redl)$name[grep(".1",spnames)]

V(redl)$name[which_loop(redl)]


res <- compare_with_ER(redl, "Regional",1000)

simulations_ER <- bind_rows(simulations_ER, res$sim)
websTbl <-bind_rows(websTbl, res$su)


#
# Run modularity 
#
set.seed(123)
modulos<-cluster_spinglass(redl)
#
# Add the modulos object to a vector  
#
mod_by_red[[2]] <- modulos

# Plot Network
#

# Check for detritos
# 
grep("detr", V(redl)$name, ignore.case = TRUE, value=TRUE  )
grep("necr", V(redl)$name, ignore.case = TRUE, value=TRUE  )

# Calculate Trophic Position
#
require(NetIndices)
trophl<-TrophInd(get.adjacency(redl,sparse=F),Dead=c("Detritus","Necromass"))
#trophl1<-TrophInd(get.adjacency(redl,sparse=F))
#any(trophl!=trophl1)
layout.matrix.1<-matrix(
  nrow=length(V(redl)),  # Rows equal to the number of vertices
  ncol=2
)

# 
# Add colors to nodes 
#
require(RColorBrewer)

colTL <-as.numeric(cut(trophl$TL,11))
colnet <- brewer.pal(11,"RdYlGn")
V(redl)$color <- colnet[12-colTL]

#
# Plot modules
#
layout.matrix.1[,2]<-jitter(trophl$TL,0.4) # y-axis value based on trophic level
layout.matrix.1[,1]<-jitter(modulos$membership,1) # randomly assign along x-axis

#png("Figures/RegionalFoodWeb.png",width=6,height=6,units="in",res=600)
par(fig = c(0, 1, 0, 1), oma = c(0, 0, 0, 0), mar = c(0, 0, 0, 0))

plot(redl, vertex.color=vertex_attr(redl)$cor,vertex.label=NA,
     vertex.size=log(3*igraph::degree(redl)),
     edge.width=.3,edge.arrow.size=.4, 
     edge.color="grey50",
     edge.curved=0.3, layout=layout.matrix.1)

dev.off()

wedd <- redl

rm(redl,res,trophl,trophl1,troph.net2,q,layout.matrix.1,modulos,zq)
save.image()

```


# Modularity Analysis - MetaWEB!

```{r ModularityAnalysisMetaWeb, eval=FALSE,echo=F,message=T,warning=T}

#
# Select food web 
#
dtot1 <- as.matrix(dtot %>% filter(Network=="Meta") %>% dplyr::select(Prey_name,Predator_name))
redl <- graph_from_edgelist(dtot1, directed  = T)

# Select only a connected subgraph graph 
if( components(redl)$no > 1) {
  V(redl)$comp <- components(redl)$membership
  redm <- induced_subgraph(redl,V(redl)$comp==1)
  
  # Unconnected components 
  redd <- induced_subgraph(redl,V(redl)$comp==2)
  redl <- simplify(redm)

}
# Delete cannibalistic 
redl <- simplify(redl)

#
# Make short names 
#
require(vegan)
spnames <- make.cepnames(V(redl)$name)
#write.csv(V(redl)$name,"Meta.csv")


# Test by eye if there are duplicated species
#
V(redl)$name[grep(".1",spnames)]


# Compare with Random Erdos Renyi networks
#
res <- compare_with_ER(redl, "Meta",1000)

simulations_ER <- bind_rows(simulations_ER, res$sim)
websTbl <-bind_rows(websTbl, res$su)


#
# Run modularity 
#
set.seed(123)
modulos<-cluster_spinglass(redl)

#
# Add the modulos object to a vector  
#
mod_by_red[[3]] <- modulos


#
# Calculate Trophic Position
#
V(redl)$name[grep("Detritus",spnames)]
V(redl)[V(redl)$name=="Necromass"]
grep("detr", V(redl)$name, ignore.case = TRUE, value=TRUE  )
grep("necr", V(redl)$name, ignore.case = TRUE, value=TRUE  )

require(NetIndices)
trophl<-TrophInd(get.adjacency(redl,sparse=F))
layout.matrix.1<-matrix(
  nrow=length(V(redl)),  # Rows equal to the number of vertices
  ncol=2
)

# 
# Add colors to nodes 
#
require(RColorBrewer)

colTL <-as.numeric(cut(trophl$TL,11))
colnet <- brewer.pal(11,"RdYlGn")
V(redl)$color <- colnet[12-colTL]

#
# Plot modules
#
layout.matrix.1[,2]<-jitter(trophl$TL,0.4) # y-axis value based on trophic level
layout.matrix.1[,1]<-jitter(modulos$membership,1) # randomly assign along x-axis

#png("Figures/MetaFoodWeb.png",width=6,height=6,units="in",res=600)
par(fig = c(0, 1, 0, 1), oma = c(0, 0, 0, 0), mar = c(0, 0, 0, 0))

plot(redl, vertex.color=vertex_attr(redl)$cor,vertex.label=NA,
     vertex.size=log(3*igraph::degree(redl)),
     edge.width=.3,edge.arrow.size=.4, 
     edge.color="grey50",
     edge.curved=0.3, layout=layout.matrix.1)

dev.off()

meta <- redl

rm(redl, dtot,dtot1,res,trophl,q,layout.matrix.1,modulos,zq,oldcd)

save.image()


require(pander)
panderOptions('table.split.table',Inf)
panderOptions('table.style', 'multiline')

pandoc.table(t(websTbl %>% dplyr::select(Network,Size,Links,Connectance,PathLength,Clustering,SWness,SWnessCI,Q,zQ,Qlow,Qhigh,mTI,zTI,TIlow,TIhigh,Modularity,zMO,MOlow,MOhigh) %>% mutate_if(is.numeric, round, digits=4)))


```

# Analysis of motif - Potter

```{r motifAnalysisLocal, eval=FALSE,echo=F,message=T,warning=T}


#
# Motif
#
mot <- triad_census(pott)

mot[4] # Exploitative competition
mot[5] # Apparent competition
mot[6] # Tri-trophic chain
mot[9] # Omnivory

freq_all_Motif <- data.frame(Network="Local",t(mot))

set.seed(123)
motif_ER <- calc_motif_random(pott)
motif_ER <- motif_ER %>% mutate(Network="Local")

rm(mot)
save.image()
```

# Analysis of motif - Weddell

```{r motifAnalysisRegional, eval=FALSE,echo=F,message=T,warning=T}
#
# Motif
#
mot <- triad_census(wedd)
mot[4] # Exploitative competition
mot[5] # Apparent competition
mot[6] # Tri-trophic chain
mot[9] # Omnivory


freq_all_Motif <- rbind(freq_all_Motif,data.frame(Network="Regional",t(mot)))

mot[10] # Loop 

set.seed(123)
motif_ER <- bind_rows( motif_ER, calc_motif_random(wedd) %>% mutate(Network="Regional"))

rm(mot)
save.image()

```


# Motif Analysis - MetaWEB!

```{r MotifAnalysisMetaWeb, eval=FALSE,echo=F,message=T,warning=T}
#
# Motif
#
mot <- triad_census(meta)
mot[4] # Exploitative competition
mot[5] # Apparent competition
mot[6] # Tri-trophic chain
mot[9] # Omnivory

freq_all_Motif <- rbind(freq_all_Motif,data.frame(Network="Meta",t(mot)))

mot[10] # Loop 


set.seed(123)
motif_ER <- bind_rows( motif_ER, calc_motif_random(meta) %>% mutate(Network="Meta"))

rm(mot)
save.image()

require(pander)
panderOptions('table.split.table',Inf)
panderOptions('table.style', 'multiline')

motif_ER <- motif_ER %>% dplyr::select(Network, everything())

pandoc.table(t(motif_ER %>% mutate_if(is.numeric, round, digits=4)))

```

# Analisis of motif frequency change across networks !!! SEGUIR ACA !!!!!!

Pag 616 The R book

```{r MotifAnalysisMetaWebAcross, eval=FALSE,echo=F,message=T,warning=T}
require(dplyr)
#
# Build a dataframe with the relevant motifs
# 
pFM<- freq_all_Motif %>% group_by(Network) %>% dplyr::select(X4:X6,X9) %>% rename(EC=X4,AC=X5,TT=X6,OM=X9) %>% mutate(Tot=sum(EC,AC,TT,OM)) %>% ungroup()

require(tidyr)

pFM1 <- pFM %>% mutate(EC=EC/Tot,AC=AC/Tot,TT=TT/Tot, OM=OM/Tot) %>% dplyr::select(Network:OM) %>%gather(motif,count,EC:OM)
levels(pFM1$Network) <- c("Potter Cove","Weddell Sea","Meta-web")
require(ggplot2)
gP1 <- ggplot(pFM1,aes(x=Network,y=count,fill=motif)) + geom_bar(stat="identity") + 
  scale_fill_brewer(palette = "RdYlGn", breaks=c("EC","AC","TT","OM"), name="", labels=c("Exploitative\ncompetition", "Apparent\ncompetition", "Tri-trophic\nchain","Omnivory")) + 
  xlab("") + ylab("Proportion") + theme_bw() + theme(legend.position="bottom")
ggsave("Figures/MotifProportionByNetwork.png",width=6,height=6,units="in",dpi=600)

#
# Test it using poisson glm (only the interaction counts )
#
pFM1 <- pFM %>%  dplyr::select(Network:OM) %>%gather(motif,count,EC:OM)

model1 <- glm(count~Network*motif,poisson, data=pFM1)
summary(model1)
model2 <- glm(count~Network+motif,poisson, data=pFM1)

anova(model1,model2,test="Chi")

#
# Pearson Chi-squared independence 
#

x <- freq_all_Motif %>% dplyr::select(X4:X6,X9) %>% rename(EC=X4,AC=X5,TT=X6,OM=X9)
x <- as.matrix(x)
rownames(x) <- c("Potter Cove","Weddell Sea","Meta-web")
require(RColorBrewer)
colnet <- brewer.pal(11,"RdYlGn")[c(1,11)]
png("Figures/NetworkByMotifFreq.png",width=6,height=6,units="in",res=600)
par(fig = c(0, 1, 0, 1), oma = c(0, 0, 0, 0), mar = c(2, 2, 0, 2))
colnames(x) <- c("Exploitative\ncompetition", "Apparent\ncompetition", "Tri-trophic\nchain","Omnivory")
assocplot(t(x),col=colnet)
dev.off()
#require(vcd)
#assoc(x, main = "Relation Network and motif", shade = TRUE)

chisq.test(x,simulate.p.value = T, B=10000)
spineplot(x)
```
 
# Topological Roles


@Kortsch2015

The role is described by two parameters: (i) the standardized within-module degree z and (ii) the among-module
connectivity participation coefficient PC. The z-score reflects how well a species is connected to other species inside the module relative to other species within its own module. The PC parameter estimates the distribution of a species’ connections across the modules.


```{r topologicalRoles, eval=TRUE,echo=F,message=T,warning=T}

source("R/network_fun.r")

require(igraph)
require(dplyr)
require(stringr)

#
# assign variable redl to work with Potter Cove
#
redl <- pott

# 110 Simulations 
#
topoRoles <- incremental_topoRoles(redl, "Local")

# Initialize hub_conn
hub_conn <- data.frame()

# Plot and clasify topological roles
hub_conn <- bind_rows(hub_conn, plot_topological_roles(filter(topoRoles,Network=="Local"),redl,mod_by_red[[1]]) %>% mutate(Network="Local"))

dev.off()

save.image()

rm(tR,tR1,tR2,tR3)

######################################################
#
# Select Weddell food web 
#
redl <- wedd

# Incremental calculation of topological roles
#
# 110 Simulations 
#
topoRoles <- bind_rows(topoRoles, incremental_topoRoles(redl, "Regional"))


#
# Plot and clasify topological roles
#

hub_conn <- bind_rows(hub_conn,plot_topological_roles(filter(topoRoles,Network=="Regional"),redl,mod_by_red[[2]]) %>% mutate(Network="Regional"))

dev.off()

save.image()

##############################################################
#
# Select metaweb 
#
redl <- meta


# Incremental calculation of topological roles
#
# 110 Simulations 
#
topoRoles <- bind_rows(topoRoles, incremental_topoRoles(redl, "Meta"))

hub_conn <- bind_rows(hub_conn,plot_topological_roles(filter(topoRoles,Network=="Meta"),redl,mod_by_red[[3]]) %>% mutate(Network="Meta"))

save.image()

# Topological Roles proportions test and plot
#
#
names(hub_conn)

tbl <- table(hub_conn$Network,hub_conn$type)

tbl1 <- tbl[c(1,3,2),] 

chisq.test(tbl,simulate.p.value = TRUE, B=10000)


require(ggplot2)
require(scales)
df1 <- data.frame(tbl1)
names(df1) <- c("Network","Rol","count")
df1 <- filter(df1,count!=0)
df1 <- df1 %>% group_by(Network) %>% mutate(total=sum(count),Freq=count/total)
levels(df1$Network) <- c("Potter Cove","Weddell Sea","Meta-web")


gP2 <- ggplot(df1,aes(x=Network,y=Freq,fill=Rol)) + geom_bar(stat="identity") + 
  scale_fill_brewer(palette = "RdYlGn",name="") + 
  xlab("") + ylab("") + theme_bw() + theme(legend.position="bottom")
ggsave("Figures/TopoRolesProportionByNetwork.png",width=6,height=6,units="in",dpi=600)


# Plot motif frequency 
# 
#
pFM<- freq_all_Motif %>% group_by(Network) %>% dplyr::select(X4:X6,X9) %>% rename(EC=X4,AC=X5,TT=X6,OM=X9) %>% mutate(Tot=sum(EC,AC,TT,OM)) %>% ungroup()
require(tidyr)
pFM1 <- pFM %>% mutate(EC=EC/Tot,AC=AC/Tot,TT=TT/Tot, OM=OM/Tot) %>% dplyr::select(Network:OM) %>%gather(motif,count,EC:OM)
levels(pFM1$Network) <- c("Potter Cove","Weddell Sea","Meta-web")
require(ggplot2)
gP1 <- ggplot(pFM1,aes(x=Network,y=count,fill=motif)) + geom_bar(stat="identity") + 
  scale_fill_brewer(palette = "RdYlGn", breaks=c("EC","AC","TT","OM"), name="", labels=c("Exploitative\ncompetition", "Apparent\ncompetition", "Tri-trophic\nchain","Omnivo-\nry")) + 
  xlab("") + ylab("Proportion") + theme_bw() + theme(legend.position="bottom")



gP1 <- gP1 +  theme(legend.key.width = unit(.5, "cm"))
gP2 <- gP2 +  theme(legend.key.width = unit(.5, "cm"))

require(cowplot)
gP3 <- plot_grid(gP1,gP2,labels = c("A","B"),align = "h")
save_plot("Figures/PropMotif_Roles_ByNetwork.png",gP3,base_width=8,base_height=5,dpi=600)
#ggsave("Figures/PropMotif_Roles_ByNetwork.png",width=8,height=5,units="in",dpi=600)


#
#   Plot of topological roles with confidence interval
#

require(ggplot2)

topoRoles$Network <- factor(topoRoles$Network, levels = c("Local","Regional","Meta")) 
levels(topoRoles$Network)= c("Potter Cove","Weddell Sea","Meta-web")

g <- ggplot(topoRoles, aes(x=among_module_conn,y=within_module_degree,colour=Network),shape=21) +  theme_bw() + geom_point()+ 
	geom_errorbar(aes(ymin=wtmLowCI, ymax=wtmHiCI),width=0.0,alpha=0.5) +
  geom_errorbarh(aes(xmin = amcLowCI, xmax = amcHiCI),height=0.0,alpha=0.5) + 
  ylab("Within module degree") + xlab("Among module connectivity") +
	scale_colour_brewer(palette="Dark2",name="Network") + theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90, hjust = 0))

g + geom_hline(aes(yintercept=2.5),linetype = 2) + geom_vline(aes(xintercept=0.625),linetype = 2) +facet_wrap( ~Network)

ggsave("Figures/TopoRolesCI_ByNetwork.png",width=7,height=5,units="in",dpi=600)

#
# Add network area to the table with network info
# 
websTbl$Area <- c(6.8,3.5e6,34.8e6)

ggplot(websTbl,aes(log(Area),log(Size))) + geom_point() + geom_line()

#
# Calc the species area exponent
#
lm(log(websTbl$Size[2:3]) ~ log(websTbl$Area[2:3]))
lm(log(websTbl$Size[1:2]) ~ log(websTbl$Area[1:2]))
lm(log(websTbl$Size) ~ log(websTbl$Area))

exp(4.2822)*(websTbl$Area[2])^0.1193

```

# Integrated plot of topological roles, trophic level and modularity

```{r plotTopoRolesTLmod, eval=FALSE,echo=F,message=T,warning=T}

# Read data and trim species names to avoid duplicates 
#
# dtot <- read.delim("Data/FoodwebsFixed.dat", quote="",stringsAsFactors = F)
# dtot <- dtot %>% mutate(Predator_name=str_trim(Predator_name), Prey_name=str_trim(Prey_name))

# Data frame hub_conn have the topological roles of species by network
#

# mod_by_red have the modules
#
# Correct hub_conn if it has more nodes
if ( sum(websTbl$Size)!= nrow(hub_conn) ) {

  hub_conn <- hub_conn %>% filter(!grepl("#",name)) 

}

# 
# Local 
#
png("Figures/AllTopoRoles_TL_MOD.png",width=8,height=8,units="in",res=600)
par(mfcol=c(2,2), mar=c(1,1.2,0.5,0.5), oma=c(2,2,2,0))

#plotTopoRolesByTLByMod(dtot,"Local", "",mod_by_red[[1]],hub_conn)

plotTopoRolesByTLByMod("Local",c("Fresh detritus","Aged detritus","Necromass"),mod_by_red[[1]],topoFrame=hub_conn,redl=pott)
mtext("A", side = 3, adj = 0.05, line=1 ,cex=1.2)

#
# Metaweb
#
plotTopoRolesByTLByMod(netName ="Meta",c("Detritus","Necromass"),mod_by_red[[3]],topoFrame= hub_conn,redl=meta)
mtext("C", side = 3, adj = 0.05, line = 0,cex=1.2)

# modulos<-cluster_spinglass(redl)
# plotTopoRolesByTLByMod(dtot,"Meta",c("Detritus","Necromass"),modulos,hub_conn)
# mod_by_red[[3]] <- modulos

#
# Regional 
#
plotTopoRolesByTLByMod(netName ="Regional",c("Detritus","Necromass"),mod_by_red[[2]],topoFrame= hub_conn,redl=wedd)
mtext("B", side = 3, adj = 0.05, line=1,cex=1.2)


require(RColorBrewer)
colnet <- brewer.pal(4,"Paired")

#par( mar=c(1,1,0.5,0.5), oma=c(2,2,2,1))


plot(1, type = "n", axes=FALSE, xlab="", ylab="")
legend(x = "center",
        legend = c("Hub connectors", "Module Connectors", "Module Hubs", "Module Specialists"), 
        col=colnet,pch=19, cex=1.2)
mtext("Modules", side = 1, outer=T, line=0.1,cex=1.2,font=2)
mtext("Trophic level", side = 2, outer=T, line=0.5,cex=1.2,font=2)


# mtext("B", side = 3, adj = 0.05, outer=F,line=-1,cex=1.2)
# mtext("B", side = 3, adj = 0.05, outer=F,line=0,cex=1.2)
# box("plot", lty="dotted", col="red")
# box("inner", lty="dotted", col="green")
# box("outer", lty="solid", col="green")

dev.off()


```

# Generate datafrane with topological roles species names trophic level and degree 

```{r checkTopoRolesTLmod, eval=FALSE,echo=F,message=T,warning=T}
require(dplyr)
hub_conn %>% filter(type=="hubcon")

unique(hub_conn$type)

tRD <- getTopoRolesTLdegree(dtot,"Local",c("Fresh detritus","Aged detritus","Necromass"),hub_conn)
tRD <- bind_rows(tRD, getTopoRolesTLdegree(dtot,"Regional",c("Detritus","Necromass"),hub_conn))
tRD <- bind_rows(tRD, getTopoRolesTLdegree(dtot,"Meta",c("Detritus","Necromass"),hub_conn))

topoRolesDegree <- tRD
rm(tRD)
topoRolesDegree %>% group_by(type,Network) %>% summarise(n=n())

# Generate table of more connected topological roles
#
require(pander)
panderOptions('table.split.table',Inf)
panderOptions('table.style', 'multiline')

# Change names of networks
topoRolesDegree$Network <- factor(topoRolesDegree$Network)
levels(topoRolesDegree$Network) <- c("Potter","Meta-web","Weddell")

pandoc.table(topoRolesDegree %>% filter(type=="hubcon" | type=="modhub" ) %>% arrange(type,Network,trophLevel) %>%  dplyr::select(type,Network,name,preys,predators,trophLevel) %>% mutate_if(is.numeric, round, digits=2))

# 
#

topoRolesDegree %>% mutate(basal=(round(trophLevel,2)<=1)) %>% group_by(type,Network,basal) %>% summarise(n=n())

save.image()

```


